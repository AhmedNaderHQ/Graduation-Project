<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - Dashboard</title>


    <link href="assets/dist/css/bootstrap.min.css" rel="stylesheet">


    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">


    <link href="assets/css/colors.css" rel="stylesheet">
    <link href="assets/css/dashboard.css" rel="stylesheet">
    <link href="assets/css/header-styles.css" rel="stylesheet">
    <link href="assets/css/sidebar-styles.css" rel="stylesheet">
    <link href="assets/css/user-profile.css" rel="stylesheet">
    <link href="assets/css/components-loader.css" rel="stylesheet">
    <link href="assets/css/settings.css" rel="stylesheet">
    <link href="assets/css/offcanvas-fix.css" rel="stylesheet">

    <style>
        .settings-container {
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .setting-card {
            background: linear-gradient(145deg, #1a1a1a, #2a2a2a);
            border-radius: 15px;
            margin-bottom: 1.5rem;
            padding: 1.5rem;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.6);
            transition: all 0.3s ease;
            color: white;
            border: 1px solid rgba(0, 255, 255, 0.1);
        }

        .setting-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.7);
            border-color: rgba(0, 255, 255, 0.3);
        }

        .setting-card h2 {
            color: #00ffff;
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid rgba(0, 255, 255, 0.2);
            font-size: 1.4rem;
            font-weight: 600;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }

        .info-item {
            background: rgba(0, 255, 255, 0.1);
            border-radius: 10px;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
            border: 1px solid rgba(0, 255, 255, 0.2);
        }

        .info-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 255, 255, 0.2);
            border-color: rgba(0, 255, 255, 0.4);
        }

        .info-label {
            color: #bbb;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .info-value {
            color: #fff;
            font-weight: 600;
            font-size: 1rem;
        }

        .support-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
        }

        .support-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .support-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .support-item.emergency {
            border-color: #ff4444;
            background: rgba(255, 68, 68, 0.1);
        }

        .support-item.chat {
            border-color: #4caf50;
            background: rgba(76, 175, 80, 0.1);
        }

        .support-item.email {
            border-color: #2196f3;
            background: rgba(33, 150, 243, 0.1);
        }

        .support-item i {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .support-item.emergency i {
            color: #ff4444;
        }

        .support-item.chat i {
            color: #4caf50;
        }

        .support-item.email i {
            color: #2196f3;
        }

        .support-item h3 {
            color: #fff;
            margin-bottom: 0.5rem;
            font-size: 1.2rem;
        }

        .support-item p {
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 1.5rem;
            font-size: 0.9rem;
        }

        .support-btn {
            display: inline-block;
            padding: 0.6rem 1.2rem;
            background: #00ffff;
            color: #000;
            text-decoration: none;
            border-radius: 6px;
            transition: all 0.3s ease;
            margin-top: 0.5rem;
            font-weight: 600;
        }

        .support-btn:hover {
            background: #00cccc;
            transform: translateY(-2px);
            color: #000;
        }

        .settings-grid {
            display: grid;
            gap: 1rem;
        }

        .setting-item {
            background: rgba(0, 255, 255, 0.1);
            border-radius: 8px;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .setting-select {
            background: #333;
            color: white;
            border: 1px solid #555;
            border-radius: 4px;
            padding: 0.5rem;
        }

        .setting-input {
            background: #333;
            color: white;
            border: 1px solid #555;
            border-radius: 4px;
            padding: 0.5rem;
            width: 200px;
        }

        .setting-input:focus {
            outline: none;
            border-color: #00ffff;
            box-shadow: 0 0 5px rgba(0, 255, 255, 0.3);
        }

        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.4s;
            border-radius: 30px;
        }

        .toggle:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
        }

        input:checked + .toggle {
            background-color: #00ffff;
        }

        input:checked + .toggle:before {
            transform: translateX(30px);
        }

        .unit-toggle {
            display: flex;
            border-radius: 6px;
            overflow: hidden;
        }

        .unit-btn {
            padding: 0.5rem 1rem;
            background: #333;
            color: white;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .unit-btn.active {
            background: #00ffff;
            color: #000;
        }

        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 2rem;
        }

        .chart-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid rgba(0, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .chart-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 255, 255, 0.1);
            border-color: rgba(0, 255, 255, 0.4);
        }

        .chart-title {
            color: #00ffff;
            font-size: 1.2rem;
            margin-bottom: 1rem;
            font-weight: 600;
        }

        canvas {
            width: 100% !important;
            height: 300px !important;
        }

        @media (max-width: 768px) {
            .charts-container {
                grid-template-columns: 1fr;
            }

            .chart-card {
                min-width: auto;
            }

            .info-grid {
                grid-template-columns: 1fr;
            }

            .support-grid {
                grid-template-columns: 1fr;
            }
        }



        /* User Profile Window Styles */
        .user-window {
            background: var(--gradient-card);
            border-radius: var(--border-radius-md);
            padding: 20px;
            color: var(--text-white);
            width: 450px;
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 1000;
            box-shadow: var(--shadow-lg);
            min-width: 400px;
            backdrop-filter: blur(10px);
            border: 1px solid var(--bg-hover-white);
            display: none;
            height: 85%;
            overflow: auto;
        }

        .profile-header {
            text-align: center;
            padding: 25px 0;
            position: relative;
            background: linear-gradient(180deg, rgba(33, 150, 243, 0.1), transparent);
            border-radius: var(--border-radius-md);
            margin-bottom: 20px;
        }

        .profile-image {
            position: relative;
            width: 150px;
            height: 150px;
            margin: 0 auto;
        }

        .profile-image img {
            width: 100%;
            height: 100%;
            border-radius: var(--border-radius-circle);
            object-fit: cover;
            border: 4px solid var(--material-blue);
            box-shadow: 0 0 10px rgba(33, 150, 243, 0.3);
        }

        .profile-image button {
            position: absolute;
            bottom: 10%;
            left: 75%;
        }

        .profile-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 20px 0;
            padding: 15px;
            background: var(--bg-hover-white);
            border-radius: var(--border-radius-md);
        }

        .stat-item {
            text-align: center;
            padding: 10px;
        }

        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: var(--material-blue);
        }

        .stat-label {
            font-size: 0.9em;
            color: var(--text-secondary);
        }

        .window-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--bg-hover-white);
        }

        .window-title {
            margin: 0;
            color: var(--text-white);
            font-size: 1.3em;
        }

        .close-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.2em;
            cursor: pointer;
            padding: 5px;
            border-radius: var(--border-radius-sm);
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: var(--bg-hover-white);
            color: var(--text-white);
        }

        .profile-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .info-group {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: var(--bg-hover-white);
            border-radius: var(--border-radius-sm);
            transition: all 0.3s ease;
        }

        .info-group:hover {
            background: var(--bg-hover-white-light);
        }

        .info-group i {
            color: var(--material-blue);
            width: 20px;
            text-align: center;
        }

        .info-group label {
            font-weight: bold;
            color: var(--text-secondary);
            margin: 0;
            min-width: 80px;
        }

        .info-group p {
            margin: 0;
            color: var(--text-white);
            flex: 1;
        }

        .profile-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .profile-actions button {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .edit-profile-btn {
            background: var(--material-blue);
            color: var(--text-white);
        }

        .settings-btn {
            background: var(--bg-hover-white-light);
            color: var(--text-white);
            border: 1px solid var(--bg-hover-white-medium);
        }

        .profile-actions button:hover {
            background-color: var(--text-blue-light);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .user-window.show {
            display: block;
            animation: fadeIn 0.3s ease-out forwards;
        }

        .progress-section {
            margin: 20px 0;
        }

        .progress-item {
            margin: 15px 0;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .progress-bar {
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--material-blue);
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        @media (max-width: 768px) {
            .user-window {
                width: 90%;
                right: 5%;
                min-width: unset;
            }

            .profile-details {
                grid-template-columns: 1fr;
            }

            .profile-stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Notification Animations */
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        /* Settings Enhancement */
        .setting-select:focus {
            outline: none;
            border-color: #00ffff;
            box-shadow: 0 0 5px rgba(0, 255, 255, 0.3);
        }

        .unit-btn:hover {
            background: #444;
            transform: translateY(-2px);
        }

        .toggle-switch:hover .toggle {
            background-color: #bbb;
        }
    </style>
</head>
<body>
    <svg class="d-none">
        <symbol id="list" viewBox="0 0 16 16">
            <path fill-rule="evenodd"
                d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z" />
        </symbol>
    </svg>

    <header class="navbar sticky-top bg-dark flex-md-nowrap p-0 shadow">
        <div class="navbar-brand col-md-3 col-lg-2 me-0">
            <img src="assets/images/laneloons-removebg-preview.png" alt="Dashboard Logo">
        </div>
        <div class="topbar">

            <!-- Enhanced DateTime Display -->
            <div class="datatime">
                <div id="time"></div>
                <div id="date"></div>
            </div>

            <!-- Enhanced Social Media Icons -->
            <div class="social-icons">
                <a href="https://www.youtube.com/" target="_blank" class="social-icon youtube" title="YouTube">
                    <i class="fab fa-youtube"></i>
                </a>
                <a href="https://web.whatsapp.com/" target="_blank" class="social-icon whatsapp" title="WhatsApp">
                    <i class="fab fa-whatsapp"></i>
                </a>
                <a href="https://www.instagram.com/" target="_blank" class="social-icon instagram" title="Instagram">
                    <i class="fab fa-instagram"></i>
                </a>
                <a href="https://twitter.com/" target="_blank" class="social-icon twitter" title="Twitter">
                    <i class="fab fa-twitter"></i>
                </a>
            </div>

            <!-- Enhanced User Actions -->
            <div style="display: flex; gap: 1.2rem; align-items: center;">
                <a class="nav-link d-flex align-items-center gap-2 has-notifications" href="#" title="Notifications">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-bell-fill"
                        viewBox="0 0 16 16">
                        <path
                            d="M8 16a2 2 0 0 0 2-2H6a2 2 0 0 0 2 2m.995-14.901a1 1 0 1 0-1.99 0A5 5 0 0 0 3 6c0 1.098-.5 6-2 7h14c-1.5-1-2-5.902-2-7 0-2.42-1.72-4.44-4.005-4.901" />
                    </svg>
                </a>
                <div class="user" title="User Profile">
                    <img src="" alt="User Avatar" loading="lazy" id="userProfileBtn">
                </div>
            </div>

            <!-- Enhanced Mobile Menu Toggle -->
            <ul class="navbar-nav flex-row d-md-none">
                <li class="nav-item text-nowrap">
                    <button class="nav-link px-3 text-white menu-toggle" type="button" data-bs-toggle="offcanvas"
                        data-bs-target="#sidebarMenu" aria-controls="sidebarMenu" aria-expanded="false"
                        aria-label="Toggle navigation" title="Menu">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-list" viewBox="0 0 16 16">
                            <path fill-rule="evenodd" d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5"/>
                        </svg>
                    </button>
                </li>
            </ul>
        </div>
    </header>

    <div class="container-fluid">
        <div class="row">
            <div class="sidebar border border-right col-sm-2 col-md-2 col-lg-1 p-0 offcanvas-md offcanvas-end" tabindex="-1"
                id="sidebarMenu" aria-labelledby="sidebarMenuLabel">
                <div class="offcanvas-header">
                    <h5 class="offcanvas-title" id="sidebarMenuLabel">Graduation</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#sidebarMenu"
                        aria-label="Close"></button>
                </div>
                <div class="menu_item d-md-flex">
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link d-flex align-items-center gap-2" href="index.html" data-label="Dashboard">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                    class="bi bi-house-door-fill" viewBox="0 0 16 16">
                                    <path
                                        d="M6.5 14.5v-3.505c0-.245.25-.495.5-.495h2c.25 0 .5.25.5.5v3.5a.5.5 0 0 0 .5.5h4a.5.5 0 0 0 .5-.5v-7a.5.5 0 0 0-.146-.354L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293L8.354 1.146a.5.5 0 0 0-.708 0l-6 6A.5.5 0 0 0 1.5 7.5v7a.5.5 0 0 0 .5.5h4a.5.5 0 0 0 .5-.5" />
                                </svg>
                                <span class="d-md-none">Dashboard</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link d-flex align-items-center gap-2" href="features.html" data-label="Features">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                    class="bi bi-ui-checks-grid" viewBox="0 0 16 16">
                                    <path
                                        d="M2 10h3a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1m9-9h3a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-3a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1m0 9a1 1 0 0 0-1 1v3a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1zm0-10a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h3a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zM2 9a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h3a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2zm7 2a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2h-3a2 2 0 0 1-2-2zM0 2a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm5.354.854a.5.5 0 1 0-.708-.708L3 3.793l-.646-.647a.5.5 0 1 0-.708.708l1 1a.5.5 0 0 0 .708 0z" />
                                </svg>
                                <span class="d-md-none">Features</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link d-flex align-items-center gap-2 active" aria-current="page" href="setting.html" data-label="Settings">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                    class="bi bi-gear-fill" viewBox="0 0 16 16">
                                    <path
                                        d="M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872l-.1-.34zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z" />
                                </svg>
                                <span class="d-md-none">Settings</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Main Content -->
            <main class="col-md-10 ms-sm-auto col-lg-11 px-md-4">
                <div class="settings-container">
                    <!-- Vehicle Information Card -->
                    <div class="setting-card">
                        <h2>Vehicle Information</h2>
                        <div class="info-grid">
                            <div class="info-item">
                                <span class="info-label">Model</span>
                                <span class="info-value">JCB Excavator 2025</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Serial Number</span>
                                <span class="info-value">JCB2025-XX-123456</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Operating Hours</span>
                                <span class="info-value">1,234 hrs</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Last Service</span>
                                <span class="info-value">2024/01/15</span>
                            </div>
                        </div>
                    </div>

                    <!-- Customer Support Card -->
                    <div class="setting-card">
                        <h2>Customer Support</h2>
                        <div class="support-grid">
                            <div class="support-item emergency">
                                <i class="fas fa-phone-alt"></i>
                                <h3>Emergency Support</h3>
                                <p>24/7 Technical Assistance</p>
                                <a href="tel:+1234567890" class="support-btn">Call Now</a>
                            </div>
                            <div class="support-item chat">
                                <i class="fas fa-comments"></i>
                                <h3>Live Chat</h3>
                                <p>Chat with Support Team</p>
                                <a href="#" class="support-btn" onclick="openLiveChat()">Start Chat</a>
                            </div>
                            <div class="support-item email">
                                <i class="fas fa-envelope"></i>
                                <h3>Email Support</h3>
                                <p>Response within 24 hours</p>
                                <a href="#" class="support-btn" onclick="openEmailSupportModal()">Send Email</a>
                            </div>
                        </div>
                    </div>



                    <!-- Analytics Dashboard Card -->
                    <div class="setting-card">
                        <h2>Analytics Dashboard</h2>
                        <div class="charts-container">
                            <div class="chart-card">
                                <h3 class="chart-title">Speed Analysis</h3>
                                <canvas id="speedChart"></canvas>
                            </div>
                            <div class="chart-card">
                                <h3 class="chart-title">Fuel Consumption</h3>
                                <canvas id="fuelChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script>
        // تهيئة Firebase - نفس الإعدادات المستخدمة في تسجيل الدخول
        const firebaseConfig = {
            apiKey: "AIzaSyBcaN8Z7LsxGgM-PXkvlLvnSYrBLaaNdVw",
            authDomain: "login-b95cf.firebaseapp.com",
            databaseURL: "https://login-b95cf-default-rtdb.firebaseio.com",
            projectId: "login-b95cf",
            storageBucket: "login-b95cf.firebasestorage.app",
            messagingSenderId: "988201091472",
            appId: "1:988201091472:web:a694121dedb5ae0f887315"
        };

        // تهيئة Firebase مع حماية من التهيئة المزدوجة
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
    </script>

    <script src="assets/dist/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/dashboard.js"></script>
    <script src="assets/js/firebase-config.js"></script>
    <script src="assets/js/auth-guard.js"></script>
    <script src="assets/js/user-profile.js"></script>
    <script src="assets/js/profile-loader.js"></script>
    <script src="assets/js/profile-fix.js"></script>
    <script src="assets/js/global-profile-fix.js"></script>
    <script src="assets/js/settings.js"></script>
    <script src="assets/js/offcanvas-fix.js"></script>

    <script>
        // تهيئة الرسوم البيانية
        document.addEventListener('DOMContentLoaded', () => {
            // بيانات السرعة
            const speedData = {
                labels: ['00:00', '01:00', '02:00', '03:00', '04:00', '05:00'],
                datasets: [{
                    label: 'Speed (KM/H)',
                    data: [0, 45, 60, 35, 55, 40],
                    borderColor: '#00ffff',
                    backgroundColor: 'rgba(0, 255, 255, 0.1)',
                    fill: true,
                    tension: 0.4
                }]
            };

            // بيانات استهلاك الوقود
            const fuelData = {
                labels: ['Day 1', 'Day 2', 'Day 3', 'Day 4', 'Day 5', 'Day 6'],
                datasets: [{
                    label: 'Fuel Consumption (L)',
                    data: [25, 30, 22, 35, 28, 32],
                    backgroundColor: 'rgba(255, 68, 68, 0.5)',
                    borderColor: '#ff4444',
                    borderWidth: 2
                }]
            };

            // خيارات مشتركة للرسوم البيانية
            const commonOptions = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: {
                            color: 'white'
                        }
                    }
                },
                scales: {
                    x: {
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        },
                        ticks: {
                            color: 'white'
                        }
                    },
                    y: {
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        },
                        ticks: {
                            color: 'white'
                        }
                    }
                }
            };

            // إنشاء رسم بياني للسرعة
            const speedChart = new Chart(
                document.getElementById('speedChart'),
                {
                    type: 'line',
                    data: speedData,
                    options: commonOptions
                }
            );

            // إنشاء رسم بياني لاستهلاك الوقود
            const fuelChart = new Chart(
                document.getElementById('fuelChart'),
                {
                    type: 'bar',
                    data: fuelData,
                    options: commonOptions
                }
            );

            // تحديث البيانات كل 5 ثواني (محاكاة البيانات في الوقت الفعلي)
            setInterval(() => {
                // تحديث بيانات السرعة
                speedData.datasets[0].data = speedData.datasets[0].data.map(() =>
                    Math.floor(Math.random() * 80)
                );
                speedChart.update();

                // تحديث بيانات الوقود
                fuelData.datasets[0].data = fuelData.datasets[0].data.map(() =>
                    Math.floor(Math.random() * 40) + 20
                );
                fuelChart.update();
            }, 5000);



            // إضافة وظيفة للإشعارات
            function showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: ${type === 'success' ? '#4CAF50' : '#2196F3'};
                    color: white;
                    padding: 15px 20px;
                    border-radius: 8px;
                    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
                    z-index: 10000;
                    animation: slideIn 0.3s ease;
                `;
                notification.textContent = message;

                document.body.appendChild(notification);

                setTimeout(() => {
                    notification.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => {
                        document.body.removeChild(notification);
                    }, 300);
                }, 3000);
            }


        });
    </script>

    <!-- User Profile Window -->
    <div class="user-window" id="draggable-user">
        <div class="window-header">
            <h3 class="window-title">User Profile</h3>
            <button class="close-btn" data-tooltip="Close"><i class="fas fa-times"></i></button>
        </div>

        <div class="user-content">
            <div class="profile-header">
                <div class="profile-image">
                    <img src="https://i.scdn.co/image/ab67616d0000b273f907de96b9a4fbc04accc0d5" alt="User Profile">
                    <button class="change-photo-btn"><i class="fas fa-camera"></i></button>
                </div>
                <div class="profile-info">
                    <h4 class="user-name">LaneLoons</h4>
                    <p class="user-role">System Administrator</p>
                </div>
            </div>

            <div class="profile-stats">
                <div class="stat-item">
                    <div class="stat-value">254</div>
                    <div class="stat-label">Total Rides</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">1.2k</div>
                    <div class="stat-label">Miles</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">4.9</div>
                    <div class="stat-label">Rating</div>
                </div>
            </div>

            <div class="progress-section">
                <div class="progress-item">
                    <div class="progress-header">
                        <span>Profile Completion</span>
                        <span>85%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 85%"></div>
                    </div>
                </div>
            </div>

            <div class="profile-details">
                <div class="info-group">
                    <i class="fas fa-user"></i>
                    <label>FirstName</label>
                    <p>lane</p>
                </div>
                <div class="info-group">
                    <i class="fas fa-user"></i>
                    <label>LastName</label>
                    <p>loons</p>
                </div>
                <div class="info-group">
                    <i class="fas fa-envelope"></i>
                    <label>Email</label>
                    <p>Laneloons@gmail.com</p>
                </div>
                <div class="info-group">
                    <i class="fas fa-phone"></i>
                    <label>Phone</label>
                    <p>+1 234 567 890</p>
                </div>
                <div class="info-group">
                    <i class="fas fa-map-marker-alt"></i>
                    <label>Location</label>
                    <p>Egypt, ElMansoura</p>
                </div>
                <div class="info-group">
                    <i class="fas fa-clock"></i>
                    <label>Last Active</label>
                    <p>Today at 12:45 PM</p>
                </div>
            </div>

            <div class="profile-actions">
                <button class="edit-profile-btn">
                    <i class="fas fa-edit"></i>
                    Edit Profile
                </button>
                <button class="logout-btn" style="background: #f44336; margin-top: 0.5rem;">
                    <i class="fas fa-sign-out-alt"></i>
                    Logout
                </button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const userProfileBtn = document.getElementById('userProfileBtn');
            const userWindow = document.getElementById('draggable-user');
            const closeBtn = userWindow.querySelector('.close-btn');
            const profileImage = userWindow.querySelector('.profile-image img');
            const changePhotoBtn = userWindow.querySelector('.change-photo-btn');

            function loadSavedImage() {
                try {
                    const savedImage = localStorage.getItem('userProfileImage');
                    if (savedImage) {
                        userProfileBtn.src = savedImage;
                        profileImage.src = savedImage;
                    }
                } catch (error) {
                    console.error('Error loading saved image:', error);
                }
            }

            loadSavedImage();

            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = 'image/*';
            fileInput.style.display = 'none';
            document.body.appendChild(fileInput);

            function handleFileSelect(e) {
                e.preventDefault();
                e.stopPropagation();
                fileInput.click();
            }

            const newChangePhotoBtn = changePhotoBtn.cloneNode(true);
            changePhotoBtn.parentNode.replaceChild(newChangePhotoBtn, changePhotoBtn);

            newChangePhotoBtn.addEventListener('click', handleFileSelect);

            fileInput.addEventListener('change', function (e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function (event) {
                        try {
                            const imageUrl = event.target.result;
                            localStorage.setItem('userProfileImage', imageUrl);
                            userProfileBtn.src = imageUrl;
                            profileImage.src = imageUrl;
                        } catch (error) {
                            console.error('Error saving image:', error);
                            alert('An error occurred while saving the image. Please try again.');
                        }
                    };
                    reader.onerror = function () {
                        console.error('Error reading file');
                        alert('An error occurred while reading the file. Please try again.');
                    };
                    reader.readAsDataURL(file);
                }
            });

            userProfileBtn.addEventListener('click', function () {
                userWindow.classList.toggle('show');
            });

            closeBtn.addEventListener('click', function () {
                userWindow.classList.remove('show');
            });

            document.addEventListener('click', function (e) {
                if (!userWindow.contains(e.target) &&
                    !userProfileBtn.contains(e.target) &&
                    userWindow.classList.contains('show')) {
                    userWindow.classList.remove('show');
                }
            });

            const editBtn = userWindow.querySelector('.edit-profile-btn');
            const logoutBtn = userWindow.querySelector('.logout-btn');

            editBtn.addEventListener('click', function () {
                if (typeof EditProfileForm !== 'undefined' && EditProfileForm.showForm) {
                    EditProfileForm.showForm();
                } else {
                    console.log('Edit Profile Form not available');
                }
            });

            logoutBtn.addEventListener('click', function () {
                if (confirm('Are you sure you want to logout?')) {
                    localStorage.removeItem('loggedInUserId');
                    localStorage.removeItem('userData');
                    localStorage.removeItem('userProfileImage');

                    window.location.href = '../login.html';
                }
            });
        });

        function removeOffcanvasBackdrop() {
            const backdrops = document.querySelectorAll('.offcanvas-backdrop');
            backdrops.forEach(backdrop => {
                backdrop.remove();
            });

            document.body.style.overflow = 'auto';
            document.body.classList.remove('modal-open');
        }

        removeOffcanvasBackdrop();

        setInterval(removeOffcanvasBackdrop, 1000);

        const sidebarMenu = document.getElementById('sidebarMenu');
        if (sidebarMenu) {
            sidebarMenu.addEventListener('hidden.bs.offcanvas', function () {
                removeOffcanvasBackdrop();
            });

            sidebarMenu.addEventListener('hide.bs.offcanvas', function () {
                removeOffcanvasBackdrop();
            });
        }
    </script>

    <div id="liveChatModal" class="chat-modal" style="display: none;">
        <div class="chat-modal-content">
            <div class="chat-modal-header">
                <h3>Live Chat Support</h3>
                <span class="chat-close" onclick="closeLiveChat()">&times;</span>
            </div>
            <div class="chat-modal-body">
                <div id="chatContainer" class="chat-container">
                    <div id="welcomeMessage" class="welcome-message"></div>
                    <div id="chatBox" class="chat-box"></div>
                    <div class="message-input">
                        <input type="text" id="messageInput" placeholder="اكتب رسالتك...">
                        <button onclick="sendMessage()" class="send-btn">إرسال</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="emailSupportModal" class="email-modal" style="display: none;">
        <div class="email-modal-content">
            <div class="email-modal-header">
                <h3>Contact Us - Email Support</h3>
                <span class="email-close" onclick="closeEmailSupportModal()">&times;</span>
            </div>
            <div class="email-modal-body">
                <div class="connect" id="contact">
                    <div class="form">
                        <div class="contact-info">
                            <h3 class="title">Let's get in touch</h3>
                            <p class="text">
                                Do Not Hesitate to Contact Us
                            </p>

                            <div class="infor">
                                <div class="information">
                                    <i class="fas fa-map-marker-alt icon"></i>
                                    <p>Misr Higher Institute for Engineering in Mansoura</p>
                                </div>
                                <div class="information">
                                    <i class="fas fa-envelope icon"></i>
                                    <p>Laneloons@gmail.com</p>
                                </div>
                                <div class="information">
                                    <i class="fas fa-phone icon"></i>
                                    <p>+201234567890</p>
                                </div>
                            </div>

                            <div class="social-media">
                                <p style="font-size: 1.2rem;">Connect with us :</p>
                                <div class="social-icon">
                                    <a href="https://www.facebook.com/share/15r6m5fziv/?mibextid=qi2Omg">
                                        <i class="fab fa-facebook-f"></i>
                                    </a>
                                    <a href="#">
                                        <i class="fab fa-twitter"></i>
                                    </a>
                                    <a href="#">
                                        <i class="fab fa-instagram"></i>
                                    </a>
                                    <a href="#">
                                        <i class="fab fa-linkedin-in"></i>
                                    </a>
                                </div>
                            </div>
                        </div>

                        <div class="contact-form">
                            <span class="circle one"></span>
                            <span class="circle two"></span>

                            <form id="emailSupportForm" action="https://api.web3forms.com/submit" method="POST" autocomplete="off">
                                <h3 class="title">Contact us</h3>
                                <input type="hidden" name="access_key" value="3ecfe002-7bdd-41d5-bd13-656fe13235bb">
                                <div class="input-container">
                                    <input type="text" name="name" id="emailSupportName" class="input" />
                                    <label for="">Username</label>
                                    <span>Username</span>
                                </div>
                                <div class="input-container">
                                    <input type="email" name="email" id="emailSupportEmail" class="input" />
                                    <label for="">Email</label>
                                    <span>Email</span>
                                </div>
                                <div class="input-container">
                                    <input type="tel" name="phone" id="emailSupportPhone" class="input" />
                                    <label for="">Phone</label>
                                    <span>Phone</span>
                                </div>
                                <div class="input-container textarea">
                                    <textarea name="message" id="emailSupportMessage" class="input" placeholder="اكتب رسالتك هنا..."></textarea>
                                    <label for="">Message</label>
                                    <span>Message</span>
                                </div>
                                <input type="submit" value="Send" class="btn" />
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Live Chat Styles - التصميم الأصلي الكامل -->
    <style>
        .chat-modal {
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .chat-modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #f4f4f4;
            width: 90%;
            max-width: 600px;
            height: 80%;
            max-height: 700px;
            font-family: 'Arial', sans-serif;
            text-align: center;
            direction: rtl;
            padding: 20px;
            overflow: hidden;
        }

        .chat-modal-header {
            background: transparent;
            color: #333;
            padding: 0 0 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: none;
        }

        .chat-modal-header h3 {
            margin: 0;
            font-size: 1.2rem;
            font-weight: normal;
            color: #333;
        }

        .chat-close {
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            color: #666;
            transition: color 0.3s ease;
        }

        .chat-close:hover {
            color: #ff4444;
        }

        .chat-modal-body {
            flex: 1;
            padding: 0;
            overflow: hidden;
            height: calc(100% - 50px);
        }

        .chat-container {
            max-width: 600px;
            margin: 20px auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            border: 1px solid #ccc;
            height: calc(100% - 40px);
            display: flex;
            flex-direction: column;
        }

        .welcome-message {
            margin: 0 0 10px 0;
            padding: 10px;
            font-size: 1.1rem;
            color: #333;
            background: transparent;
            text-align: center;
        }

        .chat-box {
            height: 400px;
            overflow-y: auto;
            border: 1px solid #eee;
            padding: 10px;
            margin-bottom: 10px;
            text-align: left;
            background-color: white;
            flex: 1;
        }

        .chat-box::after {
            content: '';
            clear: both;
            display: table;
        }

        .message {
            margin: 5px 0;
            padding: 10px;
            border-radius: 5px;
            background-color: #e9ecef;
            max-width: 70%;
            clear: both;
            position: relative;
            transition: all 0.3s ease;
        }

        .message.sent {
            background-color: #dcf8c6;
            margin-left: 20px;
            float: left;
        }

        .message.received {
            background-color: #e8e8e8;
            float: right;
        }

        .message .username {
            font-size: 0.8em;
            color: #666;
            margin-bottom: 4px;
        }

        .message .text {
            line-height: 1.4;
            color: black;
        }

        .delete-btn {
            position: absolute;
            top: 50%;
            left: 0;
            transform: translate(-50%, -50%);
            width: 24px;
            height: 24px;
            padding: 0;
            font-size: 14px;
            background-color: #ff4444;
            color: white;
            border-radius: 50%;
            opacity: 0;
            transition: opacity 0.2s ease, background-color 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: none;
            margin: 0;
        }

        .message:hover .delete-btn {
            opacity: 1;
        }

        .delete-btn:hover {
            background-color: #cc0000;
        }

        .message-input {
            margin-top: 20px;
        }

        .message-input input {
            width: calc(100% - 22px);
            padding: 5px;
            margin-bottom: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
            outline: none;
        }

        #messageInput {
            width: 97%;
            padding: 8px;
            margin-left: 10px;
        }

        .send-btn {
            width: 100%;
            padding: 8px 15px;
            margin-top: 5px;
            background: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 4px;
        }

        .send-btn:hover {
            background: #0056b3;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .chat-modal-content {
                width: 95%;
                height: 90%;
                padding: 10px;
            }

            .chat-container {
                margin: 10px auto;
            }
        }
    </style>

    <!-- Email Support Modal Styles -->
    <style>
        .email-modal {
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .email-modal-content {
            background-color: #fff;
            border-radius: 10px;
            width: 90%;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
        }

        .email-modal-header {
            background: linear-gradient(135deg, #008b77, #1abc9c);
            color: white;
            padding: 15px 20px;
            border-radius: 10px 10px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .email-modal-header h3 {
            margin: 0;
            font-size: 1.5rem;
        }

        .email-close {
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: white;
            transition: color 0.3s;
        }

        .email-close:hover {
            color: #ddd;
        }

        .email-modal-body {
            padding: 0;
        }

        /* Contact Us Styles for Modal */
        .email-modal .connect {
            position: relative;
            width: 100%;
            min-height: auto;
            padding: 0;
            background-color: transparent;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .email-modal .form {
            width: 100%;
            max-width: 100%;
            background-color: #fff;
            border-radius: 0;
            box-shadow: none;
            z-index: 1000;
            overflow: hidden;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
        }

        .email-modal .contact-form {
            background-color: #008b77;
            position: relative;
        }

        .email-modal .circle {
            border-radius: 50%;
            background: linear-gradient(135deg, transparent 20%, #008b77);
            position: absolute;
        }

        .email-modal .circle.one {
            width: 130px;
            height: 130px;
            top: 130px;
            right: -40px;
        }

        .email-modal .circle.two {
            width: 80px;
            height: 80px;
            top: 10px;
            right: 30px;
        }

        .email-modal .contact-form:before {
            content: "";
            position: absolute;
            width: 30px;
            height: 30px;
            background-color: #008b77;
            transform: rotate(45deg);
            top: 50px;
            left: -13px;
        }

        .email-modal form {
            padding: 2.3rem 2.2rem;
            z-index: 10;
            overflow: hidden;
            position: relative;
        }

        .email-modal .title {
            color: #fff;
            font-weight: 500;
            font-size: 2.5rem;
            line-height: 1;
            margin-bottom: 0.7rem;
        }

        .email-modal .input-container {
            position: relative;
            margin: 1rem 0;
        }

        .email-modal .input {
            width: 100%;
            outline: none;
            border: 2px solid #fafafa;
            background: none;
            padding: 0.6rem 1.2rem;
            color: #fff;
            font-weight: 700;
            font-size: 1.2rem;
            letter-spacing: 0.5px;
            border-radius: 25px;
            transition: 0.3s;
        }

        .email-modal textarea.input {
            padding: 0.8rem 1.2rem;
            min-height: 120px;
            border-radius: 22px;
            resize: none;
            overflow-y: auto;
        }

        .email-modal .input-container label {
            position: absolute;
            top: 50%;
            left: 15px;
            transform: translateY(-50%);
            padding: 0 0.4rem;
            color: #fafafa;
            font-size: 1.2rem;
            font-weight: 400;
            pointer-events: none;
            z-index: 1000;
            transition: 0.5s;
        }

        .email-modal .input-container.textarea label {
            top: 1rem;
            transform: translateY(0);
        }

        .email-modal .btn {
            padding: 0.6rem 1.3rem;
            background-color: #fff;
            border: 2px solid #fafafa;
            font-size: 1.2rem;
            color: #1abc9c;
            line-height: 1;
            border-radius: 25px;
            outline: none;
            cursor: pointer;
            transition: 0.3s;
            margin: 0;
        }

        .email-modal .btn:hover {
            background-color: transparent;
            color: #fff;
        }

        .email-modal .input-container span {
            position: absolute;
            top: 0;
            left: 25px;
            transform: translateY(-50%);
            font-size: 1.2rem;
            padding: 0 0.4rem;
            color: transparent;
            pointer-events: none;
            z-index: 500;
        }

        .email-modal .input-container span:before,
        .email-modal .input-container span:after {
            content: "";
            position: absolute;
            width: 10%;
            opacity: 0;
            transition: 0.3s;
            height: 5px;
            background-color: #008b77;
            top: 50%;
            transform: translateY(-50%);
        }

        .email-modal .input-container span:before {
            left: 50%;
        }

        .email-modal .input-container span:after {
            right: 50%;
        }

        .email-modal .input-container.focus label {
            top: 0;
            transform: translateY(-50%);
            left: 25px;
            font-size: 1.2rem;
        }

        .email-modal .input-container.focus span:before,
        .email-modal .input-container.focus span:after {
            width: 50%;
            opacity: 1;
        }

        .email-modal .contact-info {
            padding: 2.3rem 2.2rem;
            position: relative;
        }

        .email-modal .contact-info .title {
            color: #1abc9c;
            font-size: 2.5rem;
        }

        .email-modal .text {
            color: #333;
            margin: 1.5rem 0 2rem 0;
            font-size: 1.2rem;
        }

        .email-modal .information {
            display: flex;
            color: #555;
            margin: 0.7rem 0;
            align-items: center;
            font-size: 1.2rem;
        }

        .email-modal .icon {
            width: 20px;
            margin-right: 0.7rem;
            color: #008b77;
        }

        .email-modal .social-media {
            padding: 2rem 0 0 0;
        }

        .email-modal .social-media p {
            color: #333;
        }

        .email-modal .social-icon {
            display: flex;
            margin-top: 0.5rem;
        }

        .email-modal .social-icon a {
            width: 35px;
            height: 35px;
            border-radius: 5px;
            background: linear-gradient(45deg, #1abc9c, #149279);
            color: #fff;
            text-align: center;
            line-height: 35px;
            margin-right: 0.5rem;
            transition: 0.3s;
            text-decoration: none;
        }

        .email-modal .social-icon a:hover {
            transform: scale(1.05);
        }

        /* Responsive Design for Email Modal */
        @media (max-width: 850px) {
            .email-modal .form {
                grid-template-columns: 1fr;
            }

            .email-modal .contact-form:before {
                top: -13px;
                left: initial;
                right: 70px;
            }
        }

        @media (max-width: 768px) {
            .email-modal-content {
                width: 95%;
                height: 90%;
                margin: 20px;
            }

            .email-modal .title {
                font-size: 2rem;
            }

            .email-modal .input {
                font-size: 1rem;
            }

            .email-modal .text,
            .email-modal .information {
                font-size: 1rem;
            }
        }
    </style>

    <!-- Live Chat JavaScript -->

    <script>
        let chatDb;
        let currentChatUser = null;
        let isChatListenerActive = false;

        const chatFirebaseConfig = {
            apiKey: "AIzaSyBqfb4wHtzSLnN01LSvoOsjzbD9ebfV3f0",
            authDomain: "chat-d3938.firebaseapp.com",
            projectId: "chat-d3938",
            storageBucket: "chat-d3938.firebasestorage.app",
            messagingSenderId: "72969194",
            appId: "1:72969194:web:f7484566d85055ff8f6093",
            measurementId: "G-477JVS7S9K"
        };

        function openLiveChat() {
            if (typeof firebase === 'undefined') {
                alert('جاري تحميل النظام، يرجى الانتظار قليلاً...');
                return;
            }

            const modal = document.getElementById('liveChatModal');
            modal.style.display = 'block';

            setTimeout(() => {
                autoLoginToChat();
            }, 500);
        }

        function closeLiveChat() {
            const modal = document.getElementById('liveChatModal');
            modal.style.display = 'none';
        }

        async function autoLoginToChat() {
            try {
                let userData = null;
                const localUserData = localStorage.getItem('userData');
                if (localUserData) {
                    userData = JSON.parse(localUserData);
                } else if (typeof UserProfileManager !== 'undefined') {
                    userData = await UserProfileManager.getUserData();
                }

                if (userData && (userData.firstName || userData.displayName)) {
                    const userName = userData.firstName ?
                        `${userData.firstName} ${userData.lastName || ''}`.trim() :
                        userData.displayName || 'مستخدم';

                    currentChatUser = userName;

                    document.getElementById('welcomeMessage').textContent = `مرحباً ${userName}`;

                    await initializeChatFirebase();

                    console.log('✅ Auto-logged into chat as:', userName);
                } else {
                    currentChatUser = 'مستخدم';
                    document.getElementById('welcomeMessage').textContent = 'مرحباً مستخدم';
                    await initializeChatFirebase();
                }
            } catch (error) {
                console.error('Error auto-logging into chat:', error);
                currentChatUser = 'مستخدم';
                document.getElementById('welcomeMessage').textContent = 'مرحباً مستخدم';
                await initializeChatFirebase();
            }
        }

        async function initializeChatFirebase() {
            try {
                if (!chatDb) {
                    if (typeof firebase !== 'undefined') {
                        let existingApp = firebase.apps.find(app =>
                            app.options.projectId === 'chat-d3938'
                        );

                        if (existingApp) {
                            chatDb = firebase.firestore(existingApp);
                            console.log('✅ Using existing Firebase app for chat');
                        } else {
                            try {
                                if (!firebase.apps.length) {
                                    firebase.initializeApp(chatFirebaseConfig);
                                    chatDb = firebase.firestore();
                                } else {
                                    const chatApp = firebase.initializeApp(chatFirebaseConfig, 'chat-app');
                                    chatDb = firebase.firestore(chatApp);
                                }
                                console.log('✅ Created new Firebase app for chat');
                            } catch (initError) {
                                console.warn('Firebase init error, trying fallback:', initError);
                                if (firebase.apps.length > 0) {
                                    chatDb = firebase.firestore();
                                } else {
                                    throw new Error('No Firebase app available');
                                }
                            }
                        }

                        try {
                            await chatDb.enablePersistence().catch((err) => {
                                if (err.code == 'failed-precondition') {
                                    console.warn('Multiple tabs open, persistence can only be enabled in one tab at a time.');
                                } else if (err.code == 'unimplemented') {
                                    console.warn('The current browser does not support persistence.');
                                }
                            });
                        } catch (persistenceError) {
                            console.warn('Persistence error:', persistenceError);
                        }
                    } else {
                        throw new Error('Firebase not available');
                    }
                }

                if (currentChatUser && !isChatListenerActive) {
                    setupChatMessageListener();
                }

                chatDb.collection('messages').get().then(snapshot => {
                    console.log('💬 Total messages in database:', snapshot.size);
                    if (snapshot.size > 0) {
                        console.log('💬 Sample message:', snapshot.docs[0].data());
                    }
                }).catch(error => {
                    console.error('❌ Error checking messages:', error);
                });

                return true;
            } catch (error) {
                console.error("❌ Error initializing Chat Firebase:", error);
                try {
                    if (typeof firebase !== 'undefined') {
                        chatDb = firebase.firestore();
                        console.log("✅ Chat Firebase initialized with fallback method");
                        if (currentChatUser && !isChatListenerActive) {
                            setupChatMessageListener();
                        }
                        return true;
                    }
                } catch (fallbackError) {
                    console.error("❌ Fallback Firebase initialization failed:", fallbackError);
                }
                return false;
            }
        }

        function setupChatMessageListener() {
            if (!chatDb || isChatListenerActive) return;

            isChatListenerActive = true;
            console.log("🔄 Starting to listen for chat messages...");
            console.log('📊 Listening to collection: messages');
            console.log('📊 Current user:', currentChatUser);

            chatDb.collection('messages')
                .orderBy('timestamp')
                .onSnapshot(
                    snapshot => {
                        console.log('💬 Received', snapshot.size, 'messages from Firebase');
                        const chatBox = document.getElementById('chatBox');
                        snapshot.docChanges().forEach(change => {
                            console.log('💬 Message change type:', change.type, 'Message:', change.doc.data());
                            if (change.type === 'added') {
                                const message = change.doc.data();
                                const messageId = change.doc.id;
                                const messageDiv = document.createElement('div');
                                const isCurrentUser = message.user === currentChatUser;

                                messageDiv.className = `message ${isCurrentUser ? 'sent' : 'received'}`;
                                messageDiv.dataset.id = messageId;

                                let messageContent = `
                                    <div class="username">${message.user}</div>
                                    <div class="text">${message.text}</div>
                                `;

                                if (isCurrentUser) {
                                    messageContent += `<button class="delete-btn" onclick="confirmChatDelete('${messageId}')" title="حذف الرسالة">×</button>`;
                                }

                                messageDiv.innerHTML = messageContent;
                                chatBox.appendChild(messageDiv);
                                chatBox.scrollTop = chatBox.scrollHeight;
                            } else if (change.type === 'removed') {
                                const messageId = change.doc.id;
                                const messageElement = document.querySelector(`.message[data-id="${messageId}"]`);
                                if (messageElement) {
                                    messageElement.remove();
                                }
                            }
                        });
                    },
                    error => {
                        console.error("❌ Error listening for chat messages:", error);
                        isChatListenerActive = false;
                    }
                );
        }

        // Send Message
        function sendMessage() {
            const messageInput = document.getElementById('messageInput');
            const message = messageInput.value.trim();

            // فحوصات الأمان
            if (typeof firebase === 'undefined') {
                alert('جاري تحميل النظام، يرجى الانتظار...');
                return;
            }

            if (!chatDb) {
                alert("جاري الاتصال بقاعدة البيانات، حاول مرة أخرى");
                return;
            }

            if (!message) {
                alert('يرجى كتابة رسالة');
                return;
            }

            if (!currentChatUser) {
                alert('يرجى تسجيل الدخول أولاً');
                return;
            }

            try {
                chatDb.collection('messages').add({
                    text: message,
                    user: currentChatUser,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                })
                .then(() => {
                    console.log("✅ Message sent successfully");
                    messageInput.value = '';
                })
                .catch(error => {
                    console.error("❌ Error sending message:", error);
                    alert("حدث خطأ في إرسال الرسالة: " + error.message);
                });
            } catch (error) {
                console.error("❌ Unexpected error:", error);
                alert('حدث خطأ غير متوقع');
            }
        }

        // Confirm Delete Message
        function confirmChatDelete(messageId) {
            const confirmResult = confirm("هل أنت متأكد من حذف هذه الرسالة؟");
            if (confirmResult) {
                deleteChatMessage(messageId);
            }
        }

        // Delete Message
        function deleteChatMessage(messageId) {
            if (!chatDb) {
                alert("جاري الاتصال بقاعدة البيانات، حاول مرة أخرى");
                return;
            }

            chatDb.collection('messages').doc(messageId).get()
                .then(doc => {
                    if (doc.exists && doc.data().user === currentChatUser) {
                        return chatDb.collection('messages').doc(messageId).delete();
                    } else if (!doc.exists) {
                        alert("الرسالة غير موجودة");
                        return Promise.reject("الرسالة غير موجودة");
                    } else {
                        alert("لا يمكنك حذف رسائل المستخدمين الآخرين");
                        return Promise.reject("لا يمكنك حذف رسائل المستخدمين الآخرين");
                    }
                })
                .then(() => {
                    console.log("✅ Message deleted successfully");
                })
                .catch(error => {
                    console.error("❌ Error deleting message:", error);
                });
        }

        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                const messageInput = document.getElementById('messageInput');
                if (messageInput) {
                    messageInput.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter') {
                            sendMessage();
                        }
                    });
                }

                window.addEventListener('click', function(event) {
                    const modal = document.getElementById('liveChatModal');
                    if (event.target === modal) {
                        closeLiveChat();
                    }
                });
            }, 1000);
        });

        function openEmailSupportModal() {
            const modal = document.getElementById('emailSupportModal');
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
            setTimeout(() => {
                fillUserDataInEmailForm();
                setupEmailFormInteractions();
            }, 300);
        }

        function closeEmailSupportModal() {
            const modal = document.getElementById('emailSupportModal');
            modal.style.display = 'none';
            document.body.style.overflow = 'auto'; 
        }

        function fillUserDataInEmailForm() {
            try {
                const userData = JSON.parse(localStorage.getItem('userData') || '{}');
                const nameField = document.getElementById('emailSupportName');
                const emailField = document.getElementById('emailSupportEmail');
                const phoneField = document.getElementById('emailSupportPhone');

                if (nameField && userData.firstName && userData.lastName) {
                    nameField.value = `${userData.firstName} ${userData.lastName}`;
                    nameField.parentNode.classList.add('focus');
                }

                if (emailField && userData.email) {
                    emailField.value = userData.email;
                    emailField.parentNode.classList.add('focus');
                }

                if (phoneField && userData.phone) {
                    phoneField.value = userData.phone;
                    phoneField.parentNode.classList.add('focus');
                }

                console.log('User data filled in email support form');
            } catch (error) {
                console.error('Error filling user data:', error);
            }
        }

        function setupEmailFormInteractions() {
            const inputs = document.querySelectorAll('#emailSupportModal .input');

            inputs.forEach((input) => {
                input.addEventListener('focus', function() {
                    let parent = this.parentNode;
                    parent.classList.add('focus');
                });

                input.addEventListener('blur', function() {
                    let parent = this.parentNode;
                    if (this.value == '') {
                        parent.classList.remove('focus');
                    }
                });
            });

            const form = document.getElementById('emailSupportForm');
            if (form) {
                form.addEventListener('submit', function(e) {
                    e.preventDefault();

                    const submitBtn = form.querySelector('.btn');
                    const originalText = submitBtn.value;
                    submitBtn.value = 'Sending...';
                    submitBtn.disabled = true;

                    const formData = new FormData(form);

                    fetch('https://api.web3forms.com/submit', {
                        method: 'POST',
                        body: formData
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            alert('تم إرسال الرسالة بنجاح! سنقوم بالرد عليك قريباً.');
                            form.reset();
                            closeEmailSupportModal();
                        } else {
                            alert('حدث خطأ في إرسال الرسالة. يرجى المحاولة مرة أخرى.');
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('حدث خطأ في إرسال الرسالة. يرجى المحاولة مرة أخرى.');
                    })
                    .finally(() => {
                        submitBtn.value = originalText;
                        submitBtn.disabled = false;
                    });
                });
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            window.addEventListener('click', function(event) {
                const modal = document.getElementById('emailSupportModal');
                if (event.target === modal) {
                    closeEmailSupportModal();
                }
            });
        });
    </script>

</body>
</html>
